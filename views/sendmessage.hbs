<script type="text/javascript">
  if (localStorage.token === 'undefined') {
    console.log('product : token not defined')
    window.location.replace("/login")
  }
</script>



<main class="mdl-layout__content mdl-color--grey-100">
  <div class="demo-upd mdl-card mdl-shadow--2dp mdl-cell mdl-cell--4-col mdl-cell--8-col-tablet mdl-cell--12-col-desktop">

    <div class="innermain">

      <div class="mdl-card__title mdl-card--expand">
        <h2>Envoyer un message</h2>
      </div>
      <div class="outercontent mdl-color--grey-100">
        <p class="buttonadd">
          <a href="/pnotif/?token={{token}}">
            <button class="mdl-button mdl-js-button mdl-color-text--blue-900">
              <i class="material-icons ">folder</i> Boîte de réception
            </button>
            </a>
        </p>
        <div class="container">
          <div class="col-md-6 mx-auto">
            <div class="form-group">
              <label for="destinataire">Sélectionnez votre destinataire</label>
              <select class="form-control" id="destinataire">
                {{#each clients.users}}
                <option value="{{userUid}}">{{firstName}} {{lastName}}</option>
                {{/each}}
              </select>             
            </div>
            <div class="form-group">
              <label for="corps">Ecrivez votre message</label>
              <textarea class="form-control" id="corps" rows="5"></textarea>
            </div>
            <button id="submit" class="btn mb-2" type="submit" name="button">Envoyer votre message</button>
          </div>

          </div>

      </div>
    </div>
  </div>
  <main>




    <script>
    $(function() {
      $('#submit').click(function(){
        $.ajax({
          url: '/api/postmail/',
          method: 'POST',
          dataType: 'json',
          headers: {
            token: '{{token}}'
          },
          data: {
            messageSender: "{{userUid}}",
            messageRecipient: $('#destinataire option:selected').val(),
            messageBody: $('#corps').val()
            }
          })
        .fail(function () {
          console.log('error')
        })
        .done(function(res) {
          console.log('done');
          window.location.replace("/pnotif/?token={{token}}")
        });
      })
    });

    </script>


    <link rel="stylesheet" href="/mdl/material.min.css">
    <script src="/mdl/material.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    </body>

    </html>
